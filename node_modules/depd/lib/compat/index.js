/*!
 * depd
 * Copyright(c) 2014-2015 Douglas Christopher Wilson
 * MIT Licensed
 */

'use strict'

/**
 * Module dependencies.
 * @private
 */

<<<<<<< HEAD
var Buffer = require('buffer')
=======
>>>>>>> bcb7f0d615e8ce2970bf3e8904b809a2aa4ec6f8
var EventEmitter = require('events').EventEmitter

/**
 * Module exports.
 * @public
 */

<<<<<<< HEAD
lazyProperty(module.exports, 'bufferConcat', function bufferConcat() {
  return Buffer.concat || require('./buffer-concat')
})

lazyProperty(module.exports, 'callSiteToString', function callSiteToString() {
=======
lazyProperty(module.exports, 'callSiteToString', function callSiteToString () {
>>>>>>> bcb7f0d615e8ce2970bf3e8904b809a2aa4ec6f8
  var limit = Error.stackTraceLimit
  var obj = {}
  var prep = Error.prepareStackTrace

<<<<<<< HEAD
  function prepareObjectStackTrace(obj, stack) {
=======
  function prepareObjectStackTrace (obj, stack) {
>>>>>>> bcb7f0d615e8ce2970bf3e8904b809a2aa4ec6f8
    return stack
  }

  Error.prepareStackTrace = prepareObjectStackTrace
  Error.stackTraceLimit = 2

  // capture the stack
  Error.captureStackTrace(obj)

  // slice the stack
  var stack = obj.stack.slice()

  Error.prepareStackTrace = prep
  Error.stackTraceLimit = limit

  return stack[0].toString ? toString : require('./callsite-tostring')
})

<<<<<<< HEAD
lazyProperty(module.exports, 'eventListenerCount', function eventListenerCount() {
=======
lazyProperty(module.exports, 'eventListenerCount', function eventListenerCount () {
>>>>>>> bcb7f0d615e8ce2970bf3e8904b809a2aa4ec6f8
  return EventEmitter.listenerCount || require('./event-listener-count')
})

/**
 * Define a lazy property.
 */

<<<<<<< HEAD
function lazyProperty(obj, prop, getter) {
  function get() {
=======
function lazyProperty (obj, prop, getter) {
  function get () {
>>>>>>> bcb7f0d615e8ce2970bf3e8904b809a2aa4ec6f8
    var val = getter()

    Object.defineProperty(obj, prop, {
      configurable: true,
      enumerable: true,
      value: val
    })

    return val
  }

  Object.defineProperty(obj, prop, {
    configurable: true,
    enumerable: true,
    get: get
  })
}

/**
 * Call toString() on the obj
 */

<<<<<<< HEAD
function toString(obj) {
=======
function toString (obj) {
>>>>>>> bcb7f0d615e8ce2970bf3e8904b809a2aa4ec6f8
  return obj.toString()
}
